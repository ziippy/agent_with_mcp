# 🧪 Multi-Agent System 테스트 시나리오

## ✅ 수정 완료

### 🎯 **워크플로우 3가지 패턴**

#### 1️⃣ **일반 질문** (Agent A만 사용)
```
User: "넌 누구야?"
  ↓
Agent A 분석 → next_agents: []
  ↓
Agent A 직접 답변 (스트리밍)
```

**예상 출력:**
```
📋 [Step 1] Agent A: 질문 분석
✅ 분석 완료

🎯 판단 결과:
   질문 유형: general
   호출할 에이전트: none

💬 [Final Answer] Agent A 직접 답변
──────────────────────────────────────────────────────────────────────

안녕하세요! 저는 여러 전문 에이전트를 조율하는 AI 어시스턴트입니다...

⏱️  답변 생성 시간: 0.45초
⏱️  총 소요 시간: 1.30초
```

---

#### 2️⃣ **단일 전문 질문** (Agent A → Agent B 또는 C)
```
User: "계약서 작성 시 주의사항은?"
  ↓
Agent A 분석 → next_agents: ["legal_agent"]
  ↓
Agent B (법률 전문가) → MCP 도구 사용
  ↓
Agent A 통합 답변
```

**예상 출력:**
```
📋 [Step 1] Agent A: 질문 분석
✅ 분석 완료

🎯 판단 결과:
   질문 유형: legal_only
   호출할 에이전트: legal_agent
   • legal_agent: 계약서 작성 시 법률적 주의사항

⚖️  [Step 2] Agent B: 법률 전문가 처리
──────────────────────────────────────────────────────────────────────
질문: 계약서 작성 시 법률적 주의사항

  🔧 [LegalExpertAgent] Tool calls: 1
    ✅ Tool mcp1__get_legal_advice executed

✅ ⚖️ 처리 완료 (2.10초)

🔄 [Step 3] Agent A: 결과 통합 및 최종 답변 생성
──────────────────────────────────────────────────────────────────────

{통합 답변 스트리밍...}

⏱️  통합 답변 생성 시간: 0.85초
⏱️  총 소요 시간: 3.80초
```

---

#### 3️⃣ **복합 질문** (Agent A → Agent B + C → Agent A)
```
User: "중대재해처벌법에 대해 알아보고, 최근 사례가 있는지 찾아봐"
  ↓
Agent A 분석 → next_agents: ["legal_agent", "precedent_agent"]
  ↓
Agent B (법률 설명) → MCP Server 1
  ↓
Agent C (사례 검색) → MCP Server 2
  ↓
Agent A 통합 답변
```

**예상 출력:**
```
📋 [Step 1] Agent A: 질문 분석
✅ 분석 완료

🎯 판단 결과:
   질문 유형: legal_and_precedent
   호출할 에이전트: legal_agent, precedent_agent
   • legal_agent: 중대재해처벌법의 주요 내용 설명
   • precedent_agent: 중대재해처벌법 최근 적용 사례

⚖️  [Step 2] Agent B: 법률 전문가 처리
──────────────────────────────────────────────────────────────────────
질문: 중대재해처벌법의 주요 내용 설명

  🔧 [LegalExpertAgent] Tool calls: 1
    ✅ Tool mcp1__search_law executed

✅ ⚖️ 처리 완료 (2.34초)

📚 [Step 3] Agent C: 판례 전문가 처리
──────────────────────────────────────────────────────────────────────
질문: 중대재해처벌법 최근 적용 사례

  🔧 [PrecedentExpertAgent] Tool calls: 2
    ✅ Tool mcp2__web_search executed
    ✅ Tool mcp2__search_precedent executed

✅ 📚 처리 완료 (3.56초)

🔄 [Step 4] Agent A: 결과 통합 및 최종 답변 생성
──────────────────────────────────────────────────────────────────────

## 개요
중대재해처벌법은...

## 법률적 설명
[Agent B의 답변 기반]

## 실제 사례
[Agent C의 답변 기반]

## 결론 및 시사점
...

⏱️  통합 답변 생성 시간: 1.45초
⏱️  총 소요 시간: 7.35초
```

---

## 🧪 테스트 명령어

```bash
python multi_agent_system.py
```

### 테스트 질문 예시

1. **일반 질문 테스트**
   - "넌 누구야?"
   - "오늘 날씨 어때?"
   - "안녕하세요"

2. **법률 전문 질문**
   - "계약서 작성 시 주의사항은?"
   - "부당해고는 어떻게 정의되나요?"
   - "민법 제750조 내용은?"

3. **판례 전문 질문**
   - "부당해고 관련 판례를 알려주세요"
   - "성희롱 사건 판례 찾아줘"

4. **복합 질문**
   - "중대재해처벌법에 대해 알아보고, 최근 사례가 있는지 찾아봐"
   - "개인정보보호법 내용과 관련 판례를 설명해줘"
   - "근로기준법 제23조 내용과 실제 적용 사례"

---

## 🎯 핵심 개선 사항

| 시나리오 | 이전 동작 | 개선 후 동작 |
|---------|----------|------------|
| **"넌 누구야?"** | Agent A 분석 → 에러 또는 불필요한 에이전트 호출 | Agent A가 직접 답변 (스트리밍) ✅ |
| **"계약법 알려줘"** | Agent B만 호출 → 답변 | Agent A 분석 → Agent B → Agent A 통합 ✅ |
| **"법+판례 질문"** | Agent B 또는 C 중 하나만 선택 | Agent A → Agent B + C → Agent A 통합 ✅ |

---

## 📊 성능 예상

- **일반 질문**: ~1-2초 (Agent A만)
- **단일 전문 질문**: ~3-5초 (Agent A + B/C + A)
- **복합 질문**: ~7-10초 (Agent A + B + C + A)

---

## 🔧 디버깅

문제 발생 시 확인 사항:

1. **Agent A가 빈 배열 반환?**
   - `next_agents: []` → Agent A 직접 답변 ✅

2. **JSON 파싱 실패?**
   - 기본값으로 `["legal_agent"]` 사용
   - 에러 메시지 출력

3. **도구 호출 실패?**
   - 각 도구 실행 결과 표시
   - 실패 시에도 계속 진행

4. **콘텐츠 필터링?**
   - 명확한 메시지 출력
   - 가능한 경우 대체 답변 제공
