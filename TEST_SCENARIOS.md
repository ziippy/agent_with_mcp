# 🔀 병렬 vs 순차 실행 테스트 시나리오

## 📋 시나리오 요약

### 1️⃣ 병렬 실행 (Parallel Execution)
**질문**: "12대 중과실은 뭐야?"

**판단 근거**:
- 법률 조문과 판례는 **서로 독립적**으로 검색 가능
- 한쪽 결과가 다른 쪽 검색에 필요하지 않음
- 동시에 검색하면 시간 절약

**기대 실행 계획**:
```json
{
  "question_type": "parallel",
  "execution_order": [["mcp1", "mcp2"]],
  "queries": {
    "mcp1": "12대 중과실의 법률적 정의를 검색",
    "mcp2": "12대 중과실 관련 판례를 검색"
  },
  "dependencies": {},
  "analysis": "법률 조문과 판례는 독립적으로 검색 가능하므로 병렬 실행"
}
```

**기대 출력**:
```
🎯 판단 결과:
   질문 유형: parallel
   실행 순서: (mcp1, mcp2)
   - mcp1: 12대 중과실의 법률적 정의를 검색
   - mcp2: 12대 중과실 관련 판례를 검색

🚀 [Step 2] 2개 에이전트 병렬 처리: mcp1, mcp2
──────────────────────────────────────────────────────────────────────
  - MCP1Agent
    질문: 12대 중과실의 법률적 정의를 검색
  - MCP2Agent
    질문: 12대 중과실 관련 판례를 검색

✅ 병렬 처리 완료 (3.45초)
  ✓ MCP1Agent: 성공
  ✓ MCP2Agent: 성공

🔄 [Step 3] Agent A: 결과 통합 및 최종 답변 생성
```

---

### 2️⃣ 순차 실행 (Sequential Execution with Dependency)
**질문**: "최근 근로기준법을 위반한 사례를 찾아보고, 위반 사례에 해당되는 법 조항을 알려줘"

**판단 근거**:
- "찾아보고 ~해줘" → 첫 번째 결과가 두 번째 작업의 입력으로 필요
- 위반 사례를 먼저 찾아야 → 그 사례에 해당하는 법 조항을 검색 가능
- 의존성이 있으므로 순차 실행 필수

**기대 실행 계획**:
```json
{
  "question_type": "multiple",
  "execution_order": [["mcp1"], ["mcp2"]],
  "queries": {
    "mcp1": "최근 근로기준법 위반 사례를 검색",
    "mcp2": "위반 사례에 해당하는 근로기준법 조항을 검색"
  },
  "dependencies": {
    "mcp2": "첫 번째 에이전트가 찾은 위반 사례를 분석하여 해당되는 법 조항 검색"
  },
  "analysis": "사례를 먼저 찾은 후, 그 사례에 해당하는 법 조항을 검색해야 하므로 순차 실행"
}
```

**기대 출력**:
```
🎯 판단 결과:
   질문 유형: multiple
   실행 순서: mcp1 → mcp2
   - mcp1: 최근 근로기준법 위반 사례를 검색
      └─ 의존성: (없음)
   - mcp2: 위반 사례에 해당하는 근로기준법 조항을 검색
      └─ 의존성: 첫 번째 에이전트가 찾은 위반 사례를 분석하여 해당되는 법 조항 검색

🔧 [Step 2] MCP1Agent 처리 (순차)
──────────────────────────────────────────────────────────────────────
질문: 최근 근로기준법 위반 사례를 검색

✅ 처리 완료 (2.31초)

🔧 [Step 3] MCP2Agent 처리 (순차)
──────────────────────────────────────────────────────────────────────
질문: 위반 사례에 해당하는 근로기준법 조항을 검색
의존성: 첫 번째 에이전트가 찾은 위반 사례를 분석하여 해당되는 법 조항 검색

[Context from previous agents]
{
  "previous_agent_results": [
    {
      "agent": "MCP1Agent",
      "response": "... (위반 사례 검색 결과) ..."
    }
  ],
  "dependency_instruction": "첫 번째 에이전트가 찾은 위반 사례를 분석하여 해당되는 법 조항 검색"
}

✅ 처리 완료 (1.87초)

🔄 [Step 4] Agent A: 결과 통합 및 최종 답변 생성
```

---

## 🔍 핵심 차이점

| 구분 | 병렬 실행 | 순차 실행 |
|------|----------|----------|
| **execution_order** | `[["mcp1", "mcp2"]]` | `[["mcp1"], ["mcp2"]]` |
| **실행 방식** | 동시에 실행 | mcp1 완료 후 mcp2 실행 |
| **dependencies** | 비어있음 `{}` | 있음 (mcp2가 mcp1 결과 참고) |
| **실행 시간** | 더 빠름 (병렬) | 더 느림 (순차) |
| **사용 시점** | 독립적인 검색 | 의존적인 검색 |
| **키워드** | "~와 ~를 알려줘" | "~하고 ~해줘", "~바탕으로" |

---

## 🧪 테스트 방법

### 1. 시스템 실행
```bash
python dynamic_multi_agent.py
```

### 2. 병렬 실행 테스트
```
You> 12대 중과실은 뭐야?
```

**확인 사항**:
- ✅ `실행 순서: (mcp1, mcp2)` - 괄호로 묶여있음 (병렬)
- ✅ `🚀 병렬 처리` 메시지 출력
- ✅ 두 에이전트가 동시에 실행됨

### 3. 순차 실행 테스트
```
You> 최근 근로기준법을 위반한 사례를 찾아보고, 위반 사례에 해당되는 법 조항을 알려줘
```

**확인 사항**:
- ✅ `실행 순서: mcp1 → mcp2` - 화살표로 연결 (순차)
- ✅ `🔧 처리 (순차)` 메시지 출력
- ✅ mcp1 완료 후 mcp2 실행
- ✅ mcp2의 context에 mcp1 결과 포함
- ✅ dependencies 명시됨

---

## 🎯 추가 테스트 시나리오

### 복합 실행 (병렬 → 순차)
**질문**: "교통사고의 법률 조문과 판례를 찾아보고, 그 결과를 바탕으로 보험 처리 방법을 알려줘"

**기대 실행 계획**:
```json
{
  "execution_order": [["mcp1", "mcp2"], ["mcp3"]],
  "analysis": "법률과 판례를 병렬 검색 후, 그 결과를 종합하여 보험 처리 방법 검색"
}
```

**기대 출력**:
```
실행 순서: (mcp1, mcp2) → mcp3
                ↑ 병렬       ↑ 순차
```

---

## 💡 Agent A의 판단 로직

Agent A는 다음 키워드와 문맥을 분석하여 병렬/순차를 결정합니다:

### 병렬 실행 신호:
- "~와 ~를", "~과 ~를"
- "~은 뭐야", "~에 대해 알려줘"
- 두 질문이 독립적

### 순차 실행 신호:
- "~하고 ~해줘", "~찾아보고 ~해줘"
- "~바탕으로", "~기반으로", "~참고하여"
- "먼저 ~한 후", "~다음에"
- dependencies 필드에 명시적 의존성 설명

---

## 📌 주의사항

1. **에이전트 이름 vs 도구 이름**
   - ✅ 올바름: `execution_order: [["mcp1", "mcp2"]]`
   - ❌ 잘못됨: `execution_order: [["law-search", "precedent-search"]]`

2. **2차원 배열 형식**
   - ✅ 올바름: `[["mcp1", "mcp2"]]` - 병렬
   - ✅ 올바름: `[["mcp1"], ["mcp2"]]` - 순차
   - ❌ 잘못됨: `["mcp1", "mcp2"]` - 1차원 배열

3. **dependencies는 순차 실행 시에만**
   - 병렬 실행: `dependencies: {}`
   - 순차 실행: `dependencies: {"mcp2": "설명"}`

